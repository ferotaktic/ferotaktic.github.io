<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Rulet â€¢ YumuÅŸatÄ±lmÄ±ÅŸ Toparlama + High-Water Reset â€¢ 2&3â€™e Oyna, 1/0â€™da Bekle</title>
<style>
:root{
  --bg:#071022; --card:#0c1830; --muted:#9fb0d9; --text:#e6f0ff;
  --accent:#7c5cff; --accent2:#22e3a2; --btn:linear-gradient(90deg,var(--accent),var(--accent2));
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;background:var(--bg);color:var(--text);
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial;line-height:1.35;overflow-x:hidden}
.header{padding:16px;text-align:center;background:linear-gradient(180deg,#081329,#06101f);
  font-weight:800;color:#20e3a2}
.container{max-width:920px;margin:16px auto;padding:12px;overflow-x:hidden;touch-action:pan-y}

/* Kart */
.card{background:linear-gradient(180deg,rgba(12,24,48,.95),rgba(8,14,30,.95));
  border:1px solid rgba(124,92,255,.14);border-radius:12px;padding:16px;margin-bottom:16px;
  box-shadow:0 12px 40px rgba(2,6,23,.45)}
.h4{margin:0 0 12px;color:var(--muted);font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:.5px}

/* KayÄ±t & Kontrol â€“ iki tuÅŸ + iÅŸlemler */
.dozen-col{display:flex;flex-direction:column;gap:8px}
.btn{cursor:pointer;border:none;border-radius:10px;padding:12px 14px;font-weight:800;background:var(--btn);
  color:#051025;transition:transform .14s,opacity .14s;min-height:44px;white-space:nowrap;font-size:15px;touch-action:manipulation}
.btn:active{transform:scale(.99)}
.btn:hover{transform:translateY(-1px);opacity:.96}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.15);color:var(--text)}
.btn-dz{width:100%;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.10);color:#fff}
.btn-win{background:#0b7a5e}   /* 2 veya 3 geldi */
.btn-loss{background:#7f1d1d}  /* 1 veya 0 geldi */
.action-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

.kbd{background:#0a1327;border:1px solid rgba(255,255,255,.10);padding:6px 8px;border-radius:8px;
  color:#9fb0d9;font-size:12px;width:100%;text-align:center;margin-top:6px}

/* KPI */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:12px}
.kpi{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:10px}
.kpi .t{font-size:12px;color:var(--muted)}
.kpi .v{margin-top:6px;font-weight:900}
.badge{padding:4px 8px;border-radius:999px;font-weight:800;font-size:11px}
.badge-wait{background:#334155;color:#cbd5e1}
.badge-bet{background:#14532d;color:#a7f3d0}

/* Tablo */
.table-wrap{overflow:auto;max-height:60vh;margin-top:12px;border-radius:10px;touch-action:pan-y;overscroll-behavior:contain}
table{width:100%;border-collapse:collapse;font-size:13px;table-layout:fixed}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
th{position:sticky;top:0;background:rgba(7,16,34,.96);color:var(--muted)}

/* Ayarlar â€“ en altta, kompakt */
.settings.card{padding:12px}
.form{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px}
.group{display:flex;flex-direction:column;gap:4px}
.label{color:var(--muted);font-size:11px}
.input{width:100%;background:transparent;border:1px solid rgba(255,255,255,.10);
  color:var(--text);padding:8px 10px;border-radius:10px;min-height:36px;font-size:13px}
.small-actions{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
<div class="header">ðŸŽ¯ Rulet â€” <b>YumuÅŸatÄ±lmÄ±ÅŸ Toparlama + High-Water Reset</b> â€¢ <b>YalnÄ±zca 2&3â€™e</b> oynar â€¢ 1/0 geldikÃ§e <b>Bekle</b></div>

<div class="container">
  <!-- KayÄ±t & Kontrol -->
  <div class="card">
    <div class="h4">KayÄ±t & Kontrol</div>
    <div class="dozen-col">
      <button id="btnW" class="btn btn-dz btn-win">2 veya 3 Geldi</button>
      <button id="btnL" class="btn btn-dz btn-loss">1 veya 0 Geldi</button>
    </div>
    <div class="action-row">
      <button id="btnUndo" class="btn ghost">Geri Al</button>
      <button id="btnClear" class="btn ghost">TÃ¼m KayÄ±tlarÄ± Sil</button>
    </div>
    <div class="kbd">Klavye: W = 2/3 Â· 1/0/L = 1 veya 0 Â· Z = Geri</div>

    <div class="kpi-grid">
      <div class="kpi"><div class="t">Kasa</div><div class="v" id="kBank">5000.00</div></div>
      <div class="kpi"><div class="t">Durum</div><div class="v" id="kMode"><span class="badge badge-wait">Bekle</span></div></div>
      <div class="kpi"><div class="t">SÄ±radaki Bahis / DÃ¼zine</div><div class="v" id="kStake">30</div></div>
      <div class="kpi"><div class="t">Toplam Risk (el)</div><div class="v" id="kRisk">60</div></div>
      <div class="kpi"><div class="t">Max Stake / DÃ¼zine</div><div class="v" id="kMax">30</div></div>
      <div class="kpi"><div class="t">Toplam KayÄ±t</div><div class="v" id="kHands">0</div></div>
      <div class="kpi"><div class="t">Bahisli Eller (W/L)</div><div class="v" id="kWL">0 / 0</div></div>
      <div class="kpi"><div class="t">Net K/Z (Seans)</div><div class="v" id="kPNL">0</div></div>
      <div class="kpi"><div class="t">Tepe Bakiye</div><div class="v" id="kHW">5000.00</div></div>
      <div class="kpi"><div class="t">Ã‡ekilme (HW)</div><div class="v" id="kDD">0</div></div>
      <div class="kpi"><div class="t">KayÄ±p Serisi (Bahis)</div><div class="v" id="kLStreak">0</div></div>
    </div>

    <div class="h4" style="margin-top:12px">GeÃ§miÅŸ</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th><th>Mod</th><th>GerÃ§ek</th><th>Stake/ea</th><th>Toplam</th><th>SonuÃ§</th><th>Net</th><th>Kasa</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Ayarlar (en altta) -->
  <div class="card settings">
    <div class="h4">Ayarlar</div>
    <div class="form">
      <div class="group">
        <div class="label">BaÅŸlangÄ±Ã§ Kasa</div>
        <input id="bankIn" class="input" type="number" value="5000" step="0.01"/>
      </div>
      <div class="group">
        <div class="label">Birim (Dâ€™Alembert adÄ±mÄ±)</div>
        <input id="unitIn" class="input" type="number" value="30" step="1"/>
      </div>
      <div class="group small-actions">
        <button id="apply" class="btn">Uygula</button>
        <button id="reset" class="btn ghost">SÄ±fÄ±rla</button>
      </div>
    </div>
  </div>
</div>

<script>
(()=>{
// ------------ State ------------
let startBank = 5000;
let bank      = 5000;
let unit      = 30;              // d'Alembert adÄ±mÄ± (baÅŸlangÄ±Ã§/temel bahis)
let stakeEach = unit;            // sÄ±radaki Ã¶neri (tek dÃ¼zine)
let maxStake  = unit;

let highWater = 5000;            // eriÅŸilen en yÃ¼ksek bakiye
let hands=0, betWins=0, betLosses=0;
let mode='WAIT';                 // 'WAIT' | 'BET'
let lossStreakBet=0;             // sadece BET modundaki ardÄ±ÅŸÄ±k kayÄ±plar
const historyTags=[];            // 'W' | 'L'  (W=2/3, L=1/0)

const $=id=>document.getElementById(id);

// ------------ Helpers ------------
function modeBadge(){
  return mode==='BET'
    ? '<span class="badge badge-bet">Bahis</span>'
    : '<span class="badge badge-wait">Bekle</span>';
}
function sessionPNL(){ return bank - startBank; }
function drawdownHW(){ return Math.max(0, highWater - bank); }

// UI
function refreshKPI(){
  $('kBank').textContent  = bank.toFixed(2);
  $('kMode').innerHTML    = modeBadge();
  $('kStake').textContent = stakeEach.toString();
  $('kRisk').textContent  = (2*stakeEach).toString();
  $('kMax').textContent   = maxStake.toString();
  $('kHands').textContent = hands.toString();
  $('kWL').textContent    = `${betWins} / ${betLosses}`;
  const pnl = sessionPNL();
  $('kPNL').textContent   = (pnl>=0?'+':'')+pnl.toFixed(2);
  $('kHW').textContent    = highWater.toFixed(2);
  $('kDD').textContent    = drawdownHW().toFixed(0);
  $('kLStreak').textContent = lossStreakBet.toString();
}

function addRow(preMode, tag, result, pnl, usedStake){
  hands++;
  const actualLabel = tag==='W' ? '2/3' : '1/0';
  const st  = (preMode==='BET') ? usedStake : 'â€”';
  const tot = (preMode==='BET') ? (2*usedStake) : 'â€”';
  const net = (preMode==='BET') ? ((pnl>=0?'+':'')+pnl.toFixed(2)) : 'â€”';
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td>${hands}</td>
    <td>${preMode==='BET' ? 'Bahis' : 'Bekle'}</td>
    <td>${actualLabel}</td>
    <td>${st}</td>
    <td>${tot}</td>
    <td>${result}</td>
    <td>${net}</td>
    <td>${bank.toFixed(2)}</td>
  `;
  const tb=$('tbody'); if(tb.firstChild) tb.insertBefore(tr, tb.firstChild); else tb.appendChild(tr);
}

// ------------ YumuÅŸatÄ±lmÄ±ÅŸ Toparlama + High-Water Reset ------------
// Tek elde bÃ¼yÃ¼me limiti: +3u
function boundedIncrease(prevStake, proposed){
  const stepCap = prevStake + 3*unit;
  return Math.max(unit, Math.min(stepCap, proposed));
}
function nextStakeAfterLoss(prevStake){
  const dd = drawdownHW();
  // d'Alembert + yumuÅŸak hÄ±zlandÄ±rma: ilk kayÄ±p +1u, sonrakiler +2u
  const accel = (lossStreakBet<=1) ? unit : 2*unit;
  const proposalA = prevStake + accel;

  // HW drawdown tabanÄ± (hafifletilmiÅŸ)
  // 2. kayÄ±p â†’ dd/4, 3. kayÄ±p â†’ dd/3, 4+ kayÄ±p â†’ dd/2.5
  let divisor = 5;
  if(lossStreakBet===2) divisor = 4;
  else if(lossStreakBet===3) divisor = 3;
  else if(lossStreakBet>=4) divisor = 2.5;

  const targetB = Math.ceil((dd/divisor)/unit)*unit;
  return boundedIncrease(prevStake, Math.max(proposalA, targetB));
}
function nextStakeAfterWin(prevStake){
  const dd = drawdownHW();
  if(dd===0){
    // drawdown yoksa klasik d'Alembert geri adÄ±mÄ±
    return Math.max(unit, prevStake - unit);
  }
  // drawdown varken fazla kÃ¼Ã§Ã¼ltme: en az dd/4 ve en fazla -1u azalt
  const floor = Math.ceil((dd/4)/unit)*unit;
  const proposed = Math.max(floor, prevStake - unit);
  return Math.max(unit, proposed);
}

// ------------ Ã‡ekirdek Muhasebe (record=false ile replay destekli) ------------
function settle(tag, record=true){ // tag: 'W' | 'L'
  const preMode   = mode;
  const usedStake = (preMode==='BET') ? stakeEach : 0;
  let result='Bekle', pnl=0;

  if(preMode==='BET'){
    if(tag==='W'){                // 2 veya 3 â†’ kazanÃ§
      result='KAZAN'; pnl=+usedStake; bank+=pnl; betWins++;
      lossStreakBet=0;
      stakeEach = nextStakeAfterWin(stakeEach);
      mode='BET';
    }else{                        // 1 veya 0 â†’ kayÄ±p
      result='KAYIP'; pnl=-2*usedStake; bank+=pnl; betLosses++;
      lossStreakBet++;
      stakeEach = nextStakeAfterLoss(stakeEach);
      mode='WAIT';
    }
  }else{                          // WAIT modunda asla bahis yok
    if(tag==='W'){                // 2/3 bir kez gÃ¶rÃ¼nÃ¼rse bir SONRAKÄ° elden itibaren bahis aÃ§
      mode='BET';
    }
  }

  // --- High-Water kontrolÃ¼ ve RESET ---
  // EÄŸer mevcut bakiye, Ã¶nceki highWater'a ulaÅŸtÄ±/Ã¼stÃ¼ne Ã§Ä±ktÄ±ysa:
  // 1) highWater'Ä± gÃ¼ncelle
  // 2) stake'i BAÅžLANGIÃ‡ birime resetle (en baÅŸtaki bahse dÃ¶n)
  if(bank >= highWater){
    highWater = bank;         // yeni tepe
    stakeEach = unit;         // baÅŸlangÄ±Ã§ bahsine dÃ¶n
  }
  maxStake = Math.max(maxStake, stakeEach);

  addRow(preMode, tag, result, pnl, usedStake);
  if(record) historyTags.push(tag);
  refreshKPI();
}

// ------------ Undo (Geri Al) ------------
function undo(){
  if(!historyTags.length) return;
  historyTags.pop();
  // reset + replay
  startBank = parseFloat($('bankIn').value)||5000;
  bank      = startBank;
  unit      = parseFloat($('unitIn').value)||30;
  stakeEach = unit; maxStake=unit;
  highWater = startBank;
  hands=0; betWins=0; betLosses=0; mode='WAIT'; lossStreakBet=0;
  $('tbody').innerHTML='';
  const copy=[...historyTags];
  copy.forEach(tag=>settle(tag,false));
}

// ------------ Clear / Apply / Reset ------------
function clearAll(){
  if(!confirm('TÃ¼m kayÄ±tlarÄ± silmek istiyor musun?')) return;
  historyTags.length=0; $('tbody').innerHTML='';
  startBank = parseFloat($('bankIn').value)||5000;
  bank      = startBank;
  unit      = parseFloat($('unitIn').value)||30;
  stakeEach = unit; maxStake=unit;
  highWater = startBank;
  hands=0; betWins=0; betLosses=0; mode='WAIT'; lossStreakBet=0;
  refreshKPI();
}
function apply(){
  startBank = parseFloat($('bankIn').value)||5000;
  bank      = startBank;
  unit      = parseFloat($('unitIn').value)||30;
  stakeEach = unit; maxStake=unit;
  highWater = startBank;
  hands=0; betWins=0; betLosses=0; mode='WAIT'; lossStreakBet=0;
  historyTags.length=0; $('tbody').innerHTML='';
  refreshKPI();
}
function reset(){
  $('bankIn').value=5000; $('unitIn').value=30;
  apply();
}

// ------------ BaÄŸlantÄ±lar ------------
$('btnW').onclick = ()=>settle('W');   // 2 veya 3 geldi
$('btnL').onclick = ()=>settle('L');   // 1 veya 0 geldi
$('btnUndo').onclick = undo;
$('btnClear').onclick = clearAll;
$('apply').onclick = apply;
$('reset').onclick = reset;

document.addEventListener('keydown',(e)=>{
  if(e.key==='w'||e.key==='W'||e.key==='2'||e.key==='3') $('btnW').click();   // 2/3
  if(e.key==='l'||e.key==='L'||e.key==='1'||e.key==='0') $('btnL').click();   // 1/0
  if(e.key==='z'||e.key==='Z') $('btnUndo').click();
});

// init
refreshKPI();
})();
</script>
</body>
</html>
